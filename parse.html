<!doctype html>
<!--[if lt IE 7]>
<html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Parse json</title>


  <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script> -->
  <script>
    window.jQuery || document.write('<script src="js/libs/jquery-1.7.2.min.js"><\/script>')
  </script>


  <script>
    // var fs = require('fs');
     // var file = __dirname + '/../data/aqtest.json';

    $.getJSON('al-qaida.json', function(data) {
      var output = "<ul>";
      for(var i in data.users) {
        output += "<li>" + data.users[i].firstName + " " + data.users[i].lastName + "--" + data.users[i].joined.month + "</li>";
      }

      output += "</ul>";
      document.getElementById("placeholder")
        .innerHTML = output;
    });

    
    if(typeof(Storage) !== "undefined") {
      // Code for localStorage/sessionStorage.
    } else {
      // Sorry! No Web Storage support..
    }
    var obj = {
      name: 'Dhayalan',
      score: 100
    };

     // localStorage.setItem('gameStorage', JSON.stringify(obj));
     // And to retrieve the object later, such as on page refresh or browser close/open...

    var obj = JSON.parse(localStorage.getItem('gameStorage'));

     //fs.readFile(file, 'utf8', function(err, data) {
//    if(err) {
//      console.log('Error: ' + err);
 //     return;
 //   }

    data = JSON.parse(data);

    var tarCount = 0;
    var souCount = 0;
    for(var n in data.nodes) {
      console.log("14 data.nodes[", n, "] = ", data.nodes[n]);
      console.log("15 data.nodes[", n, "].id = ", data.nodes[n].id);
      data.nodes[n]['sourceCount'] = 0;
      data.nodes[n]['targetCount'] = 0;
      for(var l in data.links) {
        // console.log("data.links[", n, "] = ", data.links[n]); 

        if(data.links[l].source == data.nodes[n].id) {
          console.log('22  ', data.links[l].source, ' == ', data.nodes[n].id, ' TRUE');
          data.nodes[n].sourceCount = data.nodes[n].sourceCount + 1;

          souCount++;
        }
        if(data.links[l].target == data.nodes[n].id) {
          console.log('26  ', data.links[l].target, ' == ', data.nodes[n].id, ' TRUE');
          data.nodes[n].targetCount = data.nodes[n].targetCount + 1;
          tarCount++;
        }

      }
      console.log('32  ', "data.nodes[", n, "].sourceCount = ", data.nodes[n].sourceCount);
      console.log('33  ', "data.nodes[", n, "].targetCount = ", data.nodes[n].targetCount);

      console.log("tarCount = ", tarCount);
      console.log("souCount = ", souCount);

    }

    console.log("data = ", data);
    alert("pause");

    console.log("writefule ...");
    writeFile('../data/aq-qaida2.json', data, null, err);

    

    var writeFile = function(file, obj, options, callback) {
      if(callback === undefined) {
        callback = options;
        options = null;
      }

      var str = '';
      try {
        str = JSON.stringify(obj, null, me.spaces) + '\n';
        alert(str);
      } catch(err) {
        if(callback) return callback(err, null);
      }

      fs.writeFile(file, str, options, callback);
    };

    function alert(x) {
      if(x === 'undefined') {
        console.log('undefined');
      } else {
        console.log(x);
      }
      return;
    }
  </script>


</head>

<body>
</body>

</html>
